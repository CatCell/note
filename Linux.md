# Linux

## 计算机概论

### 磁盘

#### 磁盘物理组成

![Alt text](Pic/%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98.webp)

- 机械臂
- 读写头
- 盘片
  - 磁道 track：组成了柱面 Cylinder
  - 扇区 Sector：两种设计：512Bytes 4KBytes
- 主轴马达
  ![Alt text](Pic/%E7%9B%98%E7%89%87.jpg)

#### 分区格式 Partition format

> 而通常磁盘可能有多个盘片，所有盘片的同一个磁道我们称为柱面 （Cylinder）通常那是文件系统的最小单位，也就是分区的最小单位啦！为什么说“通常”呢？因为近来有 GPT 这个可达到 64bit 纪录功能的分区表， 现在我们甚至可以使用扇区（sector）号码来作为分区单位哩！

- 分区最小单位：因为一个分区对应一个文件系统，所以也是文件系统最小单位。
- 可以看出 GPT 支持更细的分区
- “64bit”记录功能的分区表

##### MBR

MBR 最多支持 4 个分区。

最高支持 2.2T 容量硬盘(不使用逻辑分区情况下)

为什么 MBR 分区格式最多支持 2TB？

> 这个和 32 位操作系统没有关系完全是 MBR 分区表规范的原因
> ![MBR分区表](https://img2020.cnblogs.com/blog/741682/202010/741682-20201008184307747-1604693136.gif)
> MBR 分区表仅有 64B，而且还分成四份，一个分区记录只用了 16B，它的结构和上图是一样的，限制在于最后使用了 4B 记录之前的扇区数和总扇区数，观察一个分区表至多只能支持$2^{32}$个扇区

$$
2^{32+9+3}=2^{2+3+40} \tag{每个扇区512B}
$$

所以最多支持 2TB

##### GPT(GUID Partition Table)

LBA（Logical Block Address, LBA）为了兼容 4K 和 512Byte

| LBA0(MBR 相容区块)                                    | LBA1(GPT 表头记录)                                          | LBA2-33(实际记录分区)             | 最后 43LBA 区块 |
| ----------------------------------------------------- | ----------------------------------------------------------- | --------------------------------- | --------------- |
| 446Bytes 开机启动程序，相容模式(带一个特殊标志分区表) | 分区表本身的位置大小，备份 GPT 分区所在位置，CRC 校验机制码 | 一个分区记录四笔，共计 128 笔分区 | 备份 GPT 分区   |

##### 开机启动流程

1.  BIOS 最先启动，寻找磁盘第一个分区里的开机管理程序 446Bytes
2.  1.  MBR：开机管理程序(Boot loader)是 OS 安装时提供，故认识磁盘，拉取核心文件
    2.  GPT：LBA 仅提供第一阶段 bootloader，需要 BIOS boot 分区存放开机管理程序(实现多重开机)
3.  交给操作系统

# storage

# bash&shell
